<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Main</title>
    <link type="text/css" rel="stylesheet" href="css/main.css">
</head>
<body>
<div id="app">
    <el-container class="mainContainer">
        <el-aside class="mainAside">
            <el-row class="tac">
                <el-col :span="12" style="width: 100%">
                    <h5>默认颜色</h5>
                    <el-menu
                            default-active="1"
                            class="el-menu-vertical-demo">
                        <el-menu-item index="1" @click="getDepartmentInfo">
                            <i class="el-icon-location"></i>
                            <span>部门管理</span>
                        </el-menu-item>
                        <el-menu-item index="2">
                            <i class="el-icon-menu"></i>
                            <span slot="title">岗位管理</span>
                        </el-menu-item>
                        <el-menu-item index="3">
                            <i class="el-icon-document"></i>
                            <span slot="title">职称管理</span>
                        </el-menu-item>
                        <el-menu-item index="4">
                            <i class="el-icon-setting"></i>
                            <span slot="title">员工信息管理</span>
                        </el-menu-item>
                        <el-menu-item index="5">
                            <i class="el-icon-setting"></i>
                            <span slot="title">考勤管理</span>
                        </el-menu-item>
                        <el-menu-item index="6">
                            <i class="el-icon-setting"></i>
                            <span slot="title">工资管理</span>
                        </el-menu-item>
                    </el-menu>
                </el-col>
            </el-row>
        </el-aside>
        <el-container>
            <el-header class="mainHead">
                <i class="el-icon-setting" style="margin-right: 15px"></i>
                <span>水水水水</span>
            </el-header>
            <el-main>
                <el-table
                        :data="this.tableData.slice((this.currentPage-1)*this.pageSize,this.pageSize*this.currentPage)"
                        style="width: 100%"
                        :cell-style="columnStyle"
                        :header-cell-style="{'text-align':'center'}">
                    <el-table-column type="index"></el-table-column>
                    <el-table-column v-for="(item,key) in this.tableHead" :key="key"
                                     :property="item.id"
                                     :label="item.name"
                                     width="180">
                    </el-table-column>
                    <el-table-column label="操作">
                        <template slot-scope="scope">
                            <el-button size="mini" type="primary" @click="tableChange(scope.row)">修改</el-button>
                            <el-button size="mini" type="danger" @click="tableDelete(scope.row)">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>

            </el-main>
            <div class="page">
                <!--                    <span class="demonstration">完整功能</span>-->
                <el-pagination
                        @size-change="handleSizeChange"
                        @current-change="handleCurrentChange"
                        :current-page="currentPage"
                        :page-sizes="[5, 10, 20, 50]"
                        :page-size="5"
                        layout="total, sizes, prev, pager, next, jumper"
                        :total="this.tableData.length">
                </el-pagination>
            </div>
        </el-container>
    </el-container>
    <!--对话框-->
    <el-dialog
            title="部门修改"
            :visible.sync="showDept"
            width="40%"
            :before-close="closeDeptDialog">
        <el-form :model="changeDeptInfo" ref="deptRuleForm" label-width="100px">
            <el-form-item label="部门工资：" prop="depMoney">
                <el-input style="width: 150px;" v-model="changeDeptInfo.depMoney" placeholder="请输入工资"
                          oninput="value=value.replace(/[^\d.]/g,'')"></el-input>
            </el-form-item>
            <el-form-item label="部门介绍：" prop="depRemark">
                <el-input style="width:400px"
                          type="textarea"
                          :rows="2"
                          :autosize="{ minRows: 2, maxRows: 2}"
                          placeholder="请输入内容"
                          v-model="changeDeptInfo.depRemark">
                </el-input>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="departmentChange">修改</el-button>
                <el-button @click="departmentReset()">重置</el-button>
            </el-form-item>
        </el-form>
    </el-dialog>
</div>

<!-- vue -->
<script src="js/vue.js"></script>
<!-- 引入样式 -->
<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
<!-- 引入组件库 -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<!--axios-->
<script src="js/axios-0.18.0.js"></script>
<script>
    new Vue({
        el: "#app",
        data() {
            return {
                url: `http://localhost:8083`,
                tableHead: [{
                    name: '时间',
                    id: 'date',
                }, {
                    name: '地点',
                    id: 'province',
                }],
                tableData: [{
                    date: '2016-05-02',
                    name: '王小虎',
                    province: '上海',
                    city: '普陀区',
                    address: '上海市普陀区金沙江路 1518 弄',
                    zip: 200333,
                    tag: '家'
                }],
                currentPage: 1,
                pageSize: 5,
                index: 1,
                showDept: false,
                changeDeptInfo: {
                    depRemark: '',
                    depMoney: 0,
                },
                tableRow: null,

            };
        },
        mounted() {
            this.getDepartmentInfo();
        },
        methods: {
            pageInit() {
                this.pageSize = 5;
                this.currentPage = 1;
            },
            getDepartmentInfo(currentPage) {
                this.index = 1;
                if (!currentPage) {
                    this.pageInit();
                }
                const _this = this;
                axios({
                    url: `${_this.url}/dep/queryAllDepInfo`,
                    method: 'get'
                }).then(function (res) {
                    _this.tableData = res.data.data.dataList;
                    _this.tableHead = res.data.data.headList;
                    if (_this.tableData.length === 0) {
                        _this.$message.warning("暂无数据!");
                    }
                });
            },
            handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange(val) {
                this.currentPage = val;
            },
            columnStyle() {
                return "text-align:center"
            },
            tableChange(row) {
                this.tableRow = row;
                if (this.index === 1) this.showDepartmentDialog(row);
            },
            tableDelete(row) {
                this.$confirm('此操作将永久删除, 是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    if (this.index === 1) this.deleteDepartment(row);
                }).catch(() => {
                });

            },
            showDepartmentDialog(row) {
                this.changeDeptInfo.depMoney = row.depMoney;
                this.changeDeptInfo.depRemark = row.depRemark;
                this.changeDeptInfo.depId = row.depId;
                this.showDept = true;
                console.log(row);
            },
            departmentChange() {
                const _this = this;
                axios({
                    url: `${_this.url}/dep/updateDepartmentInfo`,
                    method: 'post',
                    data: _this.changeDeptInfo
                }).then(function (res) {
                    const code = res.data.code;
                    const message = res.data.msg;
                    if (code !== 1) {
                        _this.$message.success(message);
                        _this.getDepartmentInfo(_this.currentPage);
                        _this.showDept = false;
                    } else {
                        _this.$message.error(message);
                    }
                });
            },
            departmentReset() {
                this.changeDeptInfo.depMoney = this.tableRow.depMoney;
                this.changeDeptInfo.depRemark = this.tableRow.depRemark;
            },
            deleteDepartment(row) {
                console.log(row)
                const _this = this;
                axios({
                    url: `${_this.url}/dep/del?id=${row.depId}`,
                    method: 'get'
                }).then(function (res) {
                    const code = res.data.code
                    if (code !== 1) {
                        _this.$message({
                            type: 'success',
                            message: '删除成功!'
                        });
                        _this.getDepartmentInfo(_this.currentPage);
                    } else {
                        _this.$message({
                            type: 'error',
                            message: '删除失败捏，有bug呢!'
                        });
                    }
                });

            },
            closeDeptDialog() {
                this.showDept = false;
            }
        }
    })
</script>
</body>
</html>